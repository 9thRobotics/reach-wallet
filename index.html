<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Buy & Sell Reach 9D-RC Token</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0a0a0a;
      color: white;
      text-align: center;
      padding: 40px;
    }
    input, button {
      padding: 10px;
      margin: 10px;
      font-size: 16px;
      width: 90%;
      max-width: 300px;
    }
    button {
      cursor: pointer;
    }
    .connected {
      color: #4caf50;
    }
    code {
      background: #222;
      padding: 5px 10px;
      border-radius: 6px;
      display: inline-block;
    }
    #status {
      font-size: 0.9rem;
      margin-top: 10px;
    }
  </style>

  <!-- Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
</head>
<body>
  <h1>Buy & Sell Reach 9D-RC Token</h1>
  <p>Fixed Price: <strong>$27.00</strong> per token (â‰ˆ 0.009 ETH)</p>

  <button onclick="connectWallet()">ðŸ”— Connect Wallet</button>
  <div id="wallet-address"></div>

  <!-- BUY -->
  <input type="number" id="buyAmt" placeholder="ETH to spend" step="0.001" min="0.001" />
  <button onclick="buyTokens()">Buy Reach Token</button>

  <!-- SELL -->
  <input type="number" id="sellAmt" placeholder="Reach tokens to sell" step="1" min="1" />
  <button onclick="sellTokens()">Sell Reach Token</button>

  <p id="status"></p>

  <p>Official Reach Token Contract:</p>
  <p>
    <code>0x41A61CdCf40a074546423Bae987B81733F3FBAc5</code><br />
    <a href="https://etherscan.io/token/0x41A61CdCf40a074546423Bae987B81733F3FBAc5" target="_blank" style="color: #4caf50;">View on Etherscan</a>
  </p>
  <button onclick="addToken()">âž• Add to MetaMask</button>

  <script>
    const SELLER = "0x0557aFA4318989702376D50B45547F953b7F9B21";
    const TOKEN  = "0x41A61CdCf40a074546423Bae987B81733F3FBAc5";
    const tokenSymbol = "9D-RC";
    const tokenDecimals = 18;
    const pricePerReachETH = 0.009;

    let provider, signer;

    const tokenAbi = [
      "function approve(address spender, uint256 amount) external returns (bool)",
      "function decimals() external view returns (uint8)"
    ];
    const sellerAbi = [
      "function buyTokens(uint256 minTokens) payable",
      "function sellTokens(uint256 tokenAmount, uint256 minEth)"
    ];

    const providerOptions = {
      walletconnect: {
        package: window.WalletConnectProvider.default,
        options: {
          infuraId: "63f289c3783f403aa722e9bda1b680aa"
        }
      }
    };

    const web3Modal = new window.Web3Modal.default({
      cacheProvider: false,
      providerOptions,
      theme: "dark",
      mobileLinks: ["metamask", "trust", "coinbase", "rainbow"]
    });

    function status(msg, ok = false) {
      const s = document.getElementById("status");
      s.innerText = msg;
      s.style.color = ok ? "#4caf50" : "#e74c3c";
    }

    async function connectWallet() {
      try {
        const instance = await web3Modal.connect();
        provider = new ethers.providers.Web3Provider(instance);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("wallet-address").innerHTML =
          "Connected: <span class='connected'>" + address + "</span>";
      } catch (err) {
        console.error("Wallet connection failed:", err);
        status("Connection failed");
      }
    }

    async function buyTokens() {
      try {
        if (!signer) return status("Connect wallet first");
        const ethIn = parseFloat(document.getElementById("buyAmt").value);
        if (!ethIn || ethIn <= 0) return status("Enter ETH amount");
        status("Buyingâ€¦");

        const seller = new ethers.Contract(SELLER, sellerAbi, signer);
        const tx = await seller.buyTokens(0, { value: ethers.utils.parseEther(ethIn.toString()) });
        await tx.wait();
        status("âœ… Bought Reach!", true);
      } catch (err) {
        console.error(err);
        status("Transaction failed");
      }
    }

    async function sellTokens() {
      try {
        if (!signer) return status("Connect wallet first");
        const amount = parseFloat(document.getElementById("sellAmt").value);
        if (!amount || amount <= 0) return status("Enter Reach amount");

        const token  = new ethers.Contract(TOKEN, tokenAbi, signer);
        const seller = new ethers.Contract(SELLER, sellerAbi, signer);
        const decimals = await token.decimals();
        const tokenAmount = ethers.utils.parseUnits(amount.toString(), decimals);

        status("Approvingâ€¦");
        await (await token.approve(SELLER, tokenAmount)).wait();

        status("Sellingâ€¦");
        await (await seller.sellTokens(tokenAmount, 0)).wait();
        status("âœ… Sold Reach!", true);
      } catch (err) {
        console.error(err);
        status("Transaction failed");
      }
    }

    async function addToken() {
      if (window.ethereum) {
        try {
          await window.ethereum.request({
            method: 'wallet_watchAsset',
            params: {
              type: 'ERC20',
              options: {
                address: TOKEN,
                symbol: tokenSymbol,
                decimals: tokenDecimals
              }
            }
          });
        } catch (error) {
          console.error("Add token failed:", error);
        }
      } else {
        alert("MetaMask is required to add the token.");
      }
    }
  </script>
</body>
</html>
